<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="Images/Opay-Logo.png">
<link rel="stylesheet" href="None">

  <script>
window.addEventListener("DOMContentLoaded", function() {
  //localStorage.setItem("AuthToken", "true");
  //localStorage.removeItem("AuthToken");
  var AuthToken = localStorage.getItem("AuthToken");
if (AuthToken) {
  //alert("AuthToken Found!");
} else {
  //alert("No AuthToken!");
  window.location.href = "404.html";
  }
});
  </script>
  
    <title>Opay</title>

<style>


body {
  font-family: Arial, sans-serif;
  background-color: #fff;
  margin: 0;
  padding: 0;
}
a {
  text-decoration: none;
  color: inherit;
}
.container {
   margin: 0 auto;
   width: 340px;
   padding: 7px;
   border: 1px solid transparent;
   border-radius: 8px;
   background-color: #F8F8FA;
}
.done p {
  cursor: pointer;
   margin-left: 87%;
   font-weight: 500;
   color: #11AF75;
}
.successful {
    justify-content: center;
    align-content: center;
    text-align: center;
}
.successful p {
    font-size: 17px;
}
.successful h2 {
    margin-top: -2px;
}
.note {
  margin-left: 20px;
  width: 300px;
}
#note {
  text-align: center;
  font-size: 12px;
  color: #11AF75;
}



.select {
  display: flex;
  flex-direction: row;
}
.share {
  margin-left: 10px;
  width: 150px;
  height: 35px;
  padding: 7px;
  border-radius: 15px;
  background-color: #FFF;
}
#share-img {
  margin-top: -2px;
  width: 40px;
  height: 40px;
}
#share {
  margin-top: -30px;
  margin-left: 45px;
  font-size: 12px;
}

.favourite {
  margin-left: 5px;
  width: 140px;
  height: 35px;
  padding: 7px;
  border-radius: 15px;
  background-color: #FFF;
}
#favourite-img {
  margin-top: -2px;
  width: 40px;
  height: 40px;
}
#favourite {
  margin-top: -30px;
  margin-left: 45px;
  font-size: 12px;
}

.useless img {
   margin-left: 5px;
}


#name-element, #dropdownMenu-element, #aza-element, #transNumber-element, #sessionID-element, #time, #trans-ref, #sessionID {
  display: none;
}





</style>
    
</head>
<body>
    <div class="container">
        <div class="done">
 
 <!--<a href="Receipt.html?price=" id="done-link"><p>Done</p></a>-->
 <p id="done-link">Done</p>
        </div>
  
        <div class="successful">
  <svg width="50px" height="50px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM16.78 9.7L11.11 15.37C10.97 15.51 10.78 15.59 10.58 15.59C10.38 15.59 10.19 15.51 10.05 15.37L7.22 12.54C6.93 12.25 6.93 11.77 7.22 11.48C7.51 11.19 7.99 11.19 8.28 11.48L10.58 13.78L15.72 8.64C16.01 8.35 16.49 8.35 16.78 8.64C17.07 8.93 17.07 9.4 16.78 9.7Z" fill="#00B875"></path> </g></svg>

       <p>Transfer successful</p>
        
    <div class="price">
     <h2 id="price">₦ 0.00</h2>
            </div>
        </div>
  <div class="note">
<p id="note">The recipient account is expected to be credited within 5 minutes, subject to notification by bank.</p>
  </div>
 

    <div class="select">
  <div class="share">
<a href="Receipt.html" id="share-link">
<img src="Images/Share-Receipt1.jpg" id="share-img">
<p id="share">Share Receipt</p>
</a>
  </div>

  <div class="favourite">
<a href="Receipt.html" id="favourite-link">
<img src="Images/Add-to-favourite1.jpg" id="favourite-img">
<p id="favourite">Add to favourites</p>
</a>
  </div>
    </div>
<br></br>

<p id="name-element"></p>
<p id="dropdownMenu-element"></p>
<p id="aza-element"></p>
<p id="transNumber-element"></p>
<p id="sessionID-element"></p>
<p id="time"></p>
<p id="trans-ref">240601011574788180</p>
<p id="sessionID">195380180159718795980353163103</p>


  <div class="useless">
<img src="Images/Useless.jpg">          
  </div>
    </div>

    
  <script>
document.getElementById('trans-ref').textContent = Array.from({length: 18}, () => Math.floor(Math.random() * 10)).join('');

// Function to update the current time
function updateTime() {
  const now = new Date();
  const options = { year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' };
  document.getElementById('time').textContent = now.toLocaleString('en-GB', options).replace(/,/, '');
}
updateTime();
//setInterval(updateTime, 120000); // Update every 2 minutes


    // Function to get the value of a query parameter by name
    function getQueryParam(param) {
        // Create a new URLSearchParams object with the query parameters from the current URL
        const urlParams = new URLSearchParams(window.location.search);
        // Get the value of the specified query parameter
        return urlParams.get(param);
    }

  const priceValue = getQueryParam('price');
  const nameValue = getQueryParam('name');
  const dropdownMenuValue = getQueryParam('dropdownMenu');
  const azaValue = getQueryParam('aza');
  const transNumberValue = getQueryParam('refNo');
  const sessionIDValue = getQueryParam('sessionID');



// Retrieve existing values from localStorage (or initialize new arrays)
let recentNames = JSON.parse(localStorage.getItem('recentName')) || [];
let recentBanks = JSON.parse(localStorage.getItem('recentBank')) || [];
let recentAzas = JSON.parse(localStorage.getItem('recentAza')) || [];

// Function to check if the new value matches the last two saved values
function isDuplicate(newName, newBank, newAza) {
    // Check if there are at least two entries to compare with
    let length = recentNames.length;

    if (length >= 1) {
        // Compare with the last saved entry
        let lastName = recentNames[length - 1];
        let lastBank = recentBanks[length - 1];
        let lastAza = recentAzas[length - 1];

        if (newName === lastName && newBank === lastBank && newAza === lastAza) {
            return true; // Last saved entry matches
        }
    }

    if (length >= 2) {
        // Compare with the second to last saved entry
        let secondLastName = recentNames[length - 2];
        let secondLastBank = recentBanks[length - 2];
        let secondLastAza = recentAzas[length - 2];

        if (newName === secondLastName && newBank === secondLastBank && newAza === secondLastAza) {
            return true; // Second to last saved entry matches
        }
    }

    return false; // No match found
}

// Push new values to the arrays only if they don't match the last two saved items
if (!isDuplicate(nameValue, dropdownMenuValue, azaValue)) {
    recentNames.push(nameValue);
    recentBanks.push(dropdownMenuValue);
    recentAzas.push(azaValue);

    // Save the updated arrays back to localStorage
    localStorage.setItem('recentName', JSON.stringify(recentNames));
    localStorage.setItem('recentBank', JSON.stringify(recentBanks));
    localStorage.setItem('recentAza', JSON.stringify(recentAzas));
} else {
    console.log('This entry already exists in the last two saved items. Not saving.');
}


if (priceValue) {
  document.getElementById('price').textContent = `₦ ${priceValue}`;
}
// Update the 'Share' link with the price, name, bank, and account number values
document.getElementById('share-link').href = `Receipt.html?price=${priceValue}&name=${nameValue}&dropdownMenu=${dropdownMenuValue}&aza=${azaValue}&refNo=${transNumberValue}&sessionID=${sessionIDValue}`;
// Update the 'Favourite' link with the price, name, bank, and account number values
document.getElementById('favourite-link').href = `Receipt.html?price=${priceValue}&name=${nameValue}&dropdownMenu=${dropdownMenuValue}&aza=${azaValue}&refNo=${transNumberValue}&sessionID=${sessionIDValue}`;



// Save the receipt details to localStorage
function saveReceipt() {
// Get the recipient details
const recipientName = nameValue;
const recipientBank = dropdownMenuValue;  // Bank name
const recipientAccount = azaValue;  // Account number
const transRef = document.getElementById('trans-ref').textContent; // Transaction Ref
const sessionID = sessionIDValue; // sessionID number


// Create an object with receipt details
const receipt = {
  amount: priceValue || "0.00",
  date: document.getElementById('time').textContent,
  recipient: recipientName,
  bank: recipientBank,
  account: recipientAccount,
  refNo: transRef,
  sessionID: sessionID,
  serviceAmount: "0.00"
};
  // Retrieve existing receipts from localStorage or initialize with an empty array
  let receipts = JSON.parse(localStorage.getItem("receipts")) || [];
  // Add the new receipt to the array
  receipts.push(receipt);

  // Save the updated array back to localStorage
  localStorage.setItem("receipts", JSON.stringify(receipts));
}

//document.getElementById('done-link').href = `index.html`;
var doneLink = document.getElementById("done-link");
doneLink.addEventListener("click", function() {
  saveReceipt();
  window.location.href = "index.html";
});

</script>


</body>
</html>
